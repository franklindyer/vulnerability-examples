import os
import socketserver
import http
import http.server

serve_dir = "/file"

content = """
    Check out my rad poems! <br>
    <a href="/file/poem1.txt">My first poem</a><br>
    <a href="/file/poem2.txt">My second poem</a><br>
    <a href="/file/poem3.txt">My third poem</a><br>
"""

class MyHandler(http.server.BaseHTTPRequestHandler):
    def do_GET(self):
        sanitized_path = os.path.relpath(os.path.normpath(os.path.join("/", self.path)), "/")
        if self.path == '/':
            self.send_response(200)
            self.send_header('Content-type', 'text/html')
            self.end_headers()
            self.wfile.write(content.encode())
        elif not os.path.abspath(self.path).startswith(serve_dir):
            self.send_response(403)
            self.end_headers()
            self.wfile.write("Sorry, you can't access anything outside of the file directory.".encode())
        elif os.path.isfile(sanitized_path):
            try:
                with open(sanitized_path, 'rb') as f:
                    data = f.read()
                self.send_response(200)
                self.end_headers()
                self.wfile.write(data)
            except Exception:
                self.send_response(500)
                self.end_headers()
                self.wfile.write("Oopsie, something went wrong on the server-side.".encode())
        else:
            self.send_response(404)
            self.end_headers()
            self.wfile.write("File not found.".encode())

httpd = socketserver.TCPServer(("", 5000), MyHandler)
httpd.serve_forever()
