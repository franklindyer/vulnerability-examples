DROPIP=$(doctl compute droplet get $1 --format 'PrivateIPv4' --no-header)
DROPID=$(doctl compute droplet get $1 --format 'ID' --no-header)

echo 'Powering down droplet...' && doctl compute droplet-action power-off $DROPID --wait=true
echo 'Taking snapshot...' && doctl compute droplet-action snapshot $DROPID --snapshot-name=pre-simulation-snapshot --wait=true
echo 'Powering up droplet...' && doctl compute droplet-action power-on $DROPID --wait=true

# Pick out random usernames and passwords
shuf -n 10 usernames.txt > userlist.txt
shuf -n 10 passwords.txt > passlist.txt

# Copy over the randomly generated usernames and passwords and delete the local copies
echo 'Copying resources to the droplet...'
sleep 20 &&
scp userlist.txt passlist.txt misconfigure root@$DROPIP:~/ &&
rm userlist.txt passlist.txt &&
# Run the 'misconfiguration script' on the remote server
echo 'Configuring remote server (poorly)...' &&
ssh root@$DROPIP 'chmod +x misconfigure && ./misconfigure'
