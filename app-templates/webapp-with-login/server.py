from flask import Flask, render_template, request
import sqlite3
import wikipedia

app = Flask(__name__)

@app.route('/')
def index():
    return render_template("index.html")

@app.route('/login', methods=['POST'])
def login_page():
    user = request.form["username"]
    passwd = request.form["password"]

    con = sqlite3.connect("accounts.db")
    cur = con.cursor()
    query = "SELECT username, secret FROM users WHERE username=? AND password=?;"
    print(query)
    res = cur.execute(query, (user, passwd,))
    matches = res.fetchall()

    if matches == []:
        return "Invalid credentials."
    else:
        username = matches[0][0]
        secret_info = wikipedia.page(matches[0][1]).summary
        return render_template("homepage.html", user=username, secret=secret_info)


app.run(host='0.0.0.0')
