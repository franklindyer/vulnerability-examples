import sqlite3
from selectedLoginApp import *

class SqliteInjectionLoginDatabaseManager(LoginDatabaseManager):
    def get_connection(self):
        con = sqlite3.connect(self.dbfile)
        return con

    def create_users_table(self):
        con = self.get_connection()
        cur = con.cursor()
        cur.execute("CREATE TABLE users (username TEXT NOT NULL, password BLOB NOT NULL, salt BLOB NOT NULL, personal TEXT);")
        con.commit()

    def add_user(self, uname, hpasswd, salt, personal):
        con = self.get_connection()
        cur = con.cursor()
        cur.execute("INSERT INTO users (username, password, salt, personal) VALUES (?, ?, ?, ?);", (uname, hpasswd, salt, personal,))
        con.commit()

    def get_user(self, uname):
        con = self.get_connection()
        cur = con.cursor()
        res = cur.execute(f"SELECT password, salt, personal FROM users WHERE username='{uname}';")
        return res.fetchone()

SelectedLoginDatabaseManager = SqliteInjectionLoginDatabaseManager
