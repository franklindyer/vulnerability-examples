import sqlite3
import random
import string
import os

from base import *

def random_password():
    return ''.join(random.choice(string.ascii_lowercase) for i in range(20))

try:
    os.remove("accounts.db")
except OSError:
    pass

con = sqlite3.connect("accounts.db")
cur = con.cursor()

cur.execute("CREATE TABLE users (id INTEGER PRIMARY KEY AUTOINCREMENT, username TEXT NOT NULL, password TEXT NOT NULL, balance FLOAT, session_key TEXT);")
cur.execute("CREATE TABLE transactions (sender INTEGER NOT NULL, receiver INTEGER NOT NULL, amount FLOAT NOT NULL, reason TEXT);")

names = ["alfonso", "beatriz", "carmen", "dani", "enrique", "fulano"]
for i in range(6):
    user = names[i] + str(random.randint(1000,9999))
    passwd = random_password()
    balance = random.randint(20,100)
    cur.execute("INSERT INTO users (username, password, balance) VALUES (?, ?, ?);", (user, passwd, balance))
    if i == 5:
        print(f"You can use the account {user} with password {passwd}.")

## Add some random example transactions
random_transactions(10, con);

con.commit()
con.close()
