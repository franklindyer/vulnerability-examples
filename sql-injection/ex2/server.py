from flask import Flask, render_template, request, make_response, send_from_directory, url_for
import sqlite3
import wikipedia
import sys

from queue import Empty, Queue
from threading import Thread

from payment_secure import *;

manager = PaymentApp()

app = Flask(__name__)

@app.route('/css/<path:path>')
def send_css(path):
    return send_from_directory('css', path)

@app.route('/')
def index():
    total_money = manager.get_statistic("total_money")
    total_users = manager.get_statistic("total_users")
    return render_template("index.html", total_money=total_money, total_users=total_users, float_convert=float_convert)

@app.route('/login', methods=['POST'])
def login_page():
    user = request.form["username"]
    passwd = request.form["password"]
    
    return manager.login_action(user, passwd)

@app.route('/logout')
def logout():
    sesskey = request.cookies.get('session_id')
    
    return manager.logout_action(sesskey)

@app.route('/home')
def home_page():
    sesskey = request.cookies.get('session_id')
    
    return manager.session_action(sesskey)

@app.route('/pay', methods=['POST'])
def pay_form():
    rid_string = request.form["recipient"]
    amt_string = request.form["amount"]
    reason = request.form["reason"]
    sesskey = request.cookies.get('session_id')
    
    return manager.payment_action(rid_string, amt_string, reason, sesskey)

app.run(host='0.0.0.0')
