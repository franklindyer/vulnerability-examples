# Turn on password authentication for SSH
sed -i "s/#?PasswordAuthentication no/PasswordAuthentication yes/g" /etc/ssh/sshd_config

# Choose 10 random usernames and password
shuf -n 10 /run/usernames.txt > /run/userlist.txt
shuf -n 10 /run/passwords.txt > /run/passlist.txt

# Add some users with terrible passwords
for i in 1 2 3 4 5 6 7 8 9 10
do
    username=$(sed "${i}q;d" /run/userlist.txt)
    password=$(sed "${i}q;d" /run/passlist.txt)
    mkdir /home/$username
    useradd $username -d /home/$username
    echo $username:$password | chpasswd
done

# Reliably present user used for testing, currently disabled
# mkdir /home/boby
# useradd boby -d /home/boby
# echo boby:boby | chpasswd

# Delete user/password lists
rm /run/userlist.txt
rm /run/passlist.txt

# Restart SSH service
service ssh start

sleep infinity
